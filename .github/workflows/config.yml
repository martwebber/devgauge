# Put this in the file: .github/workflows/verify.yml

# name: CI/CD Pipeline
# on: 
#   pull_request:
#     branches: [master,dev]
#   push:
#     branches: [master,dev]

# jobs:
#   linters:
#     name: Linters
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v2

#       - name: Setup Ruby and install gems
#         uses: ruby/setup-ruby@v1
#         with:
#           ruby-version: 3.1.0

#       - name: Run linters
#         run: |
#           bin/rubocop --parallel
#           bin/stylelint
#           bin/prettier
#           bin/eslint

#       - name: Run security checks
#         run: |
#           bin/bundler-audit --update
#           bin/brakeman -q -w2

  # tests:
  #   name: Tests
  #   runs-on: ubuntu-latest
  #   services:
  #     postgres:
  #       image: postgres:12.7
  #       env:
  #         POSTGRES_USER: myapp
  #         POSTGRES_DB: myapp_test
  #         POSTGRES_PASSWORD: ""
  #       ports: ["5432:5432"]

  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v2

  #     - name: Setup Ruby and install gems
  #       uses: ruby/setup-ruby@v1
  #       with:
  #         bundler-cache: true

  #     - name: Setup test database
  #       env:
  #         RAILS_ENV: test
  #         PGHOST: localhost
  #         PGUSER: myapp
  #       run: |
  #         bin/rails db:setup

  #     - name: Run tests
  #       run: bin/rspec

name: CI/CD Pipeline
on: 
  pull_request:
    branches: [master,dev]
  push:
    branches: ["*"]

jobs:
  Test: 
    runs-on: ubuntu-latest
    # services:
    #   postgres:
    #     image: postgres:14.5
    #     env:
    #       POSTGRES_USER: postgres
    #       POSTGRES_PASSWORD: password
    #     ports: ["5432:5432"]

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Ruby and install gems
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: 3.1.0

      - name: Test with rspec
        run: |
          gem install bundler
          bundle config path vendor/bundle
          cd api
          bundle install
          bundle exec rspec